# Cri-CAN

Cricket Commentary Agentic Network (CWC 2011 Final). This repo turns Cricinfo-style ball-by-ball text into structured datasets and agentic commentary outputs, with deterministic v0 baselines and LLM-ready v1 generation.

## Overview
- Inputs: raw commentary text in `Cri-CAN/data/raw`.
- Outputs: CSV/JSONL/SQLite datasets, QA reports, and text commentary (v0 deterministic and v1 human-style).
- LLM: optional Ollama integration (default model: `gpt-oss:20b`).

## Project layout
- `Cri-CAN/data/raw`: original commentary text files (immutable sources).
- `Cri-CAN/data/structured/csv`: `balls.csv`, `meta.csv`, `schema.md`.
- `Cri-CAN/data/structured/csv/balls_enriched.csv`: derived stats per ball.
- `Cri-CAN/data/structured/csv/qa_report.md`: QA checks for CSV data.
- `Cri-CAN/data/structured/jsonl`: `overs.jsonl`, `narrative.jsonl`, `schema.md`.
- `Cri-CAN/data/structured/sqlite`: `commentary.sqlite`, `schema.md`.
- `Cri-CAN/data/structured/legacy_csv`: legacy CSV output.
- `Cri-CAN/data/structured/report.md`: structured data performance report.
- `Cri-CAN/tools`: build + QA tooling.
- `Cri-CAN/agentic`: v0/v1 commentary pipelines and reports.
- `Cri-CAN/config.toml`: global configuration.
- `Cri-CAN/Makefile`: reproducible build/run targets.

## Prereqs
- Python 3.11+ (stdlib only).
- Optional: Ollama for local LLM generation.

## Config
- Default config: `Cri-CAN/config.toml`
- Override with `CRI_CONFIG` or `--config /path/to/config.toml`.

Key LLM settings in config:
- `llm.command_template = "ollama run {model}"`
- `llm.model = "gpt-oss:20b"`
- `llm.multimodal_model = "gemma3:27b"`

## Build steps (reproducible)
1) Build structured datasets:
```bash
make -C Cri-CAN build
```
2) Derive stats + QA (CSV path):
```bash
make -C Cri-CAN derive
```
3) Build SQLite views:
```bash
make -C Cri-CAN sqlite-views
```

## Agentic commentary
### v0 deterministic (exact from parsed data)
- CSV:
```bash
make -C Cri-CAN agentic-csv
```
- SQLite:
```bash
make -C Cri-CAN agentic-sqlite
```
- JSONL:
```bash
make -C Cri-CAN agentic-jsonl
```
Outputs are labeled `v0-deterministic`.

### v1 human-style (LLM-ready)
```bash
make -C Cri-CAN agentic-jsonl-v1
```

Timepoint control:
```bash
python3 Cri-CAN/agentic/jsonl/run_agentic_v1.py --start 12.3 --end 14.6
python3 Cri-CAN/agentic/jsonl/run_agentic_v1.py --start 120 --limit 10
```

Recent overs context:
```bash
python3 Cri-CAN/agentic/jsonl/run_agentic_v1.py --context-overs 3 --limit 10
```

Ollama model override:
```bash
python3 Cri-CAN/agentic/jsonl/run_agentic_v1.py --model gpt-oss:20b --limit 10
```

## SQLite query layer
- Build views:
```bash
make -C Cri-CAN sqlite-views
```
- Quick query:
```bash
python3 Cri-CAN/tools/query_sqlite.py --view wickets --limit 10
```

Views include: `ball_summary`, `wickets`, `boundaries`, `extras`, `over_summaries`, `over_totals`, `partnerships`.

## Derived stats + QA (CSV)
Generated by `Cri-CAN/tools/derive_stats.py` into `Cri-CAN/data/structured/csv/balls_enriched.csv`.

Derived fields include:
- `innings_runs`, `innings_wickets`, `innings_legal_balls`, `innings_overs`
- `crr`, `rrr`, `target_runs`, `runs_remaining`, `balls_remaining`
- `phase` (powerplay/middle/death), `event_type`, `is_extra`, `is_boundary`, `is_legal_ball`

QA summary: `Cri-CAN/data/structured/csv/qa_report.md`.

## LLM usage (Ollama)
- Default command: `ollama run {model}`
- Set `llm.model` to `gpt-oss:20b` for text generation.
- `llm.multimodal_model` is reserved for later audio/video use.
- The adapter cleans any preamble (e.g., “Thinking...”) and keeps only the final line.

## Text-first strategy
Text is the baseline for correctness. Recommended flow:
1) Finalize v0 + v1 text output.
2) Add timing cues.
3) Align to audio/video.

Parallel audio/video work is fine, but it should consume validated text.

## Applications
- Live-style commentary generation from ball-by-ball feeds.
- Retrieval-based highlight clips (timepoint control + event filters).
- Analytics dashboards (over totals, partnerships, wickets, boundaries).
- Training/evaluation dataset for sports‑commentary models.
- Broadcast tooling: style variants and tone control.

## Reference docs
- End-to-end walkthrough: `Cri-CAN/README_GLOBAL.md`
- Performance report: `Cri-CAN/agentic/performance_report.md`

## GitHub
Repo: https://github.com/Vik-u/Cri-CAN.git
